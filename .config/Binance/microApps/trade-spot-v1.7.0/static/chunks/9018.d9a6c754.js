(self["webpackJsonp_trade-spot"]=self["webpackJsonp_trade-spot"]||[]).push([[9018],{DvqD:(e,t,r)=>{"use strict";r.d(t,{WH:()=>n,NP:()=>s,mf:()=>i});var a=r("D57K"),o=r("B2Fj"),n=function(e){return(0,a.__awaiter)(void 0,void 0,void 0,(function(){return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return[4,(0,o.v_)("/bapi/capital/v1/private/streamer/trade/get-user-trade-detail",e)];case 1:return[2,t.sent()]}}))}))},s=function(e){return(0,a.__awaiter)(void 0,void 0,void 0,(function(){var t;return(0,a.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(0,o.v_)("/bapi/capital/v1/private/streamer/order/get-trade-orders",e)];case 1:return t=r.sent(),[3,3];case 2:return r.sent(),t={data:[],total:0,success:!1},[3,3];case 3:return[2,t]}}))}))},i=function(e){return(0,a.__awaiter)(void 0,void 0,void 0,(function(){return(0,a.__generator)(this,(function(t){return[2,(0,o.v_)("/bapi/capital/v2/private/streamer/order/fetch-tran-orders",e)]}))}))}},rJjB:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>P});var a=r("/SIk"),o=r.n(a),n=r("GuU3"),s=r.n(n),i=r("yjzf"),c=r("fmvO"),l=r("6ppZ"),u=r("9mqn");var d=r("Ozc/"),m=r("mE5e");let y;!function(e){e.Unknown="-1",e.Canceled="0",e.PartiallyFilled="1",e.Filled="2",e.Expired="4"}(y||(y={}));var p=r("lXyA"),S=r.n(p),_=r("ArXb"),b=r("dHYI"),g=r("S24M"),h=r("b4Bg"),v=r("l3xb"),k=r("uM3s"),T=r("EWim");const f=(0,l.l6)(),E={1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",480:"8h",720:"12h","1D":"1d","3D":"3d","1W":"1w","1M":"1M"},C=({namespace:e,useMiniTicker:t=!1})=>{i.k.SessionStore.createStore(e);const r=i.k.OrderHistoryStore.createStore(e),o=(0,a.useMemo)((()=>S()((()=>(0,b.Os)({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsStart",catch({error:e,track:t}){t({GET_BAR_START_TYPE:e}),t({type:`GET_BAR_START_TYPE_${e}`})},log({track:e}){e({GET_BAR_START_TYPE:"SUCCESS"})}})))),[]),n=(0,a.useMemo)((()=>S()((()=>(0,b.Os)({eventId:"trd_chart_tv_load_timeout",stepId:"getBarsEnd",catch({error:e,track:t}){t({GET_BAR_END_TYPE:e}),t({type:`GET_BAR_END_TYPE_${e}`})},log({track:e}){e({GET_BAR_END_TYPE:"SUCCESS"})}})))),[]),{getI18n:s}=(0,c.ZK)(),[l]=(0,c.uT)(),u=(0,a.useRef)(""),d=(0,c.AM)(),m=(0,a.useRef)(d),p=(0,c._n)(),C=(0,a.useRef)(p),I=(0,a.useRef)(),[,,O,R]=r(i.k.OrderHistoryStore.getOrderHistory);m.current=d,C.current=p;const M=(0,a.useMemo)((()=>s("trd-layout-spot",{defaultValue:"Spot"})||""),[s]),D=(0,a.useMemo)((()=>({exchanges:[{name:"Binance",value:"Binance",desc:""}],symbols_types:[{name:M,value:"Spot"}]})),[M]),A=(0,a.useCallback)((async e=>{var t;if(R(),null===(t=I.current)||void 0===t||t.call(I),!C.current)return;const r=await(({accountType:e,symbol:t})=>(0,T.lz)({accountType:e,startTime:Date.now()-7776e6,endTime:Date.now(),symbol:t}))({accountType:(0,b.lx)(l),symbol:e});O(r.map((e=>({id:e.orderId.toString(),avgPrice:+e.executedPrice,executedQty:+e.executedQty,side:e.side,time:e.updateTime,status:e.status,statusCode:e.statusCode})))),I.current=f.getUserOrderStream(l).subscribe((t=>{t.symbol===e&&O([{id:t.orderId.toString(),avgPrice:t.lastPrice||t.price,executedQty:t.cumulativeFilledQuantity,side:t.side,time:t.transactionTime,status:t.orderStatus,statusCode:y.Unknown}])}))}),[O,R,l]);(0,_.Z)((()=>{A(u.current)}),[A]);const w=(0,a.useCallback)((e=>{u.current=e,A(e)}),[A]),P=(0,a.useCallback)((async()=>{try{await(0,b.YY)({checker:()=>Object.keys(m.current).length>0})}catch(t){(0,g.j)("tv_web_error",{type:"onFetchSymbolsInfo",message:t.message})}const e=m.current;return Object.keys(e).reduce(((t,r)=>{const{symbol:a="",symbolDisplay:o="",tickSize:n=""}=e[r]||{};return t[r]={name:o,fullName:a,ticker:a,tickSize:10**Math.abs(Math.log10(+n)),description:"",exchange:"Binance",supportedResolutions:i.k.DefaultResolutions,type:"Spot"},t}),{})}),[]),B=(0,a.useCallback)((async({symbolInfo:e,resolution:t,rangeStartDate:r,rangeEndDate:a})=>{o();const s=e.ticker||"",i=Math.max(0,1e3*r),c=1e3*a,l=E[t],u=(0,T.b0)({symbol:s,interval:l}),d=await(0,k.M)({onFetchKlineData:u,startTime:i,endTime:c});return n(),d}),[n,o]),x=(0,a.useCallback)((({symbolInfo:e,resolution:r,callback:a})=>{const o=e.ticker||"",n=E[r];return(0,v.Ld)({symbol:o,interval:n,useMiniTicker:t,checkIfInSync:()=>!0,callback:e=>a(e)})}),[t]),L=(0,a.useCallback)((async()=>{const{serverTime:e}=await(0,h.b)();return Math.floor(parseInt(e,10)/1e3)}),[]),Y=(0,a.useMemo)((()=>i.k.createDatafeed()),[]),{datafeed:N,symbolsInfo:H}=Y({config:D,onFetchSymbolsInfo:P,onFetchBars:B,onSubscribeBars:x,onFetchServerTimeApi:L});return{datafeed:N,symbolsInfo:H,onSymbolWillChange:w}},I="trd_chart_tv_load_timeout",O=()=>{(0,b.Os)({eventId:I,stepId:"chartResponsive",catch({error:e,track:t}){t({CHART_RESPONSIVE_TYPE:e,connection:JSON.stringify(navigator.connection)}),t({type:`CHART_RESPONSIVE_TYPE_${e}`})},log({track:e}){e({CHART_RESPONSIVE_TYPE:"SUCCESS"})}})};var R=r("yvHL"),M=r("ftV9"),D=o().createElement;const A="myTradingView",w=e=>{[u.P3].map((e=>s().createInstance({name:e}))).forEach((t=>t.setItem(A,e)))},P=({symbol:e,namespace:t,useMiniTicker:r=!1})=>{const n=i.k.Store.createStore(t),[p]=n(i.k.Store.getInterval),S=p===i.k.Store.DisplayIntervals.Time?i.k.Store.DisplayIntervals["1m"]:p,{datafeed:_,symbolsInfo:g,onSymbolWillChange:h}=C({namespace:t,useMiniTicker:r}),v=(0,c.Xw)(),{isLight:k,shouldResetTradingView:T,updateShouldResetTradingView:f}=(0,c.Fg)(),E=(P=k?"light":"dark").charAt(0).toUpperCase()+P.slice(1);var P;const B=(0,a.useMemo)((()=>s().createInstance({name:t})),[t]),{orderLines:x}=(({symbol:e,namespace:t})=>{const r=i.k.Store.createStore(t),[o]=r(i.k.Store.getShowLimitOrder),n=(0,c.H3)({symbol:e});return{orderLines:(0,a.useMemo)((()=>o?n.map((({orderId:e,quantity:t,price:r,text:a,isBuy:o,cancel:n})=>({id:e.toString(),text:a,price:+r,quantity:t.toString(),isBuy:o,tooltip:"",modifyTooltip:"",cancelTooltip:"",editable:!1,onMove:()=>null,onModify:()=>null,onCancel:n}))):[]),[n,o])}})({symbol:e,namespace:t}),{executionOrders:L}=(({symbol:e,namespace:t})=>{const r=i.k.Store.createStore(t),o=i.k.OrderHistoryStore.createStore(t),[n]=r(i.k.Store.getShowExecutionOrder),[s]=o(i.k.OrderHistoryStore.getOrderHistory),{getI18n:l}=(0,c.KL)(),u=(0,c.AM)()[e]||{},{tickSize:d="0",minQty:p="2"}=u,S=(0,a.useMemo)((()=>l("openOrder-sideBuyBOTH",{defaultValue:"Buy"})||""),[l]),_=(0,a.useMemo)((()=>l("openOrder-sideSellBOTH",{defaultValue:"Sell"})||""),[l]),b=(0,a.useMemo)((()=>Math.abs(Math.log10(+d))),[d]),g=(0,a.useMemo)((()=>Math.abs(Math.log10(+p))),[p]),h=(0,a.useCallback)((({executedQty:e})=>(0,m.mD)(e,g)),[g]);return{executionOrders:(0,a.useMemo)((()=>n?s.filter((({status:e,statusCode:t=y.Unknown,executedQty:r})=>"FILLED"===e.toUpperCase()||t===y.Filled||"PARTIAL FILL"===e.toUpperCase()||t===y.PartiallyFilled||"PARTIALLY_FILLED"===e.toUpperCase()||("EXPIRED"===e.toUpperCase()||t===y.Expired)&&r>0||("CANCELED"===e.toUpperCase()||t===y.Canceled)&&r>0)).map((({id:e,avgPrice:t,side:r,time:a,executedQty:o})=>{const n=`${"BUY"===r?S:_} ${h({executedQty:o})} @ ${t.toFixed(b)}`;return{id:e,text:"",price:t,quantity:"",time:Math.round(a/1e3),isBuy:"BUY"===r,tooltip:n}})):[]),[n,s,S,_,h,b])}})({symbol:e,namespace:t}),Y=(0,c.tZ)(),N=(0,u.GL)(Y);(0,R.f)(e,r),(0,M.H)(e,S);const H=(0,a.useCallback)((e=>w(e)),[]),U=(0,a.useCallback)((()=>(()=>{const e=(0,b.Nb)({id:"chartReady"}),t=(0,b.Nb)({id:"getBarsStart",timeout:3}),r=(0,b.Nb)({id:"getBarsEnd",timeout:6}),a=(0,b.Nb)({id:"chartResponsive",timeout:3}),o=b.Nb.auto({log:({track:e})=>{e((({duration:e})=>({type:"success",duration:(0,b.LU)(e,150)})))}});b.Os.init({eventId:I,step:e._(b.Nb.race(t._(r)._(a),a))._(o)}),(0,b.Os)({eventId:I,stepId:"chartReady",catch({error:e,track:t}){t({CHART_READY_TYPE:e,connection:JSON.stringify(navigator.connection)}),t({type:`CHART_READY_TYPE_${e}`})},log({track:e}){e({CHART_READY_TYPE:"SUCCESS",connection:JSON.stringify(navigator.connection)})}})})()),[]),F=(0,a.useCallback)((async()=>{const e=await B.getItem(A);w(e)}),[B]),V=(0,a.useCallback)((e=>d.Z.log(JSON.stringify({type:"tv-error",error:e}),"custom")),[]),Q=(0,a.useCallback)(O,[]),G=(0,a.useCallback)((()=>f(!1)),[f]);return D(o().Fragment,null,D(i.k.Containers.TradingView,{namespace:t,theme:v,storageName:A,tradingViewProps:{symbol:e,symbolsInfo:g,theme:E,limitOrders:x,positionOrders:[],executionOrders:L,overwritingThemeOnLoaded:T,initialConfig:{tvConfig:{library_path:`${l.Or}/charting_library_next/`,symbol:e,theme:E,locale:N,datafeed:_},onSave:H,onChartReadyDone:U,onWillUnmount:F,onCreateOrderShapesError:V,onFirstTimeDataLoadedDone:Q,onSymbolWillChange:h,onSetThemeDone:G}}}))}}}]);